# Linux用户管理

## Linux中用户和用户组概念
用户：使用操作系统的人
用户组：拥有相同权限的一组人
Linux系统允许多用户同时登录Linux操作系统。
Linux系统中可以存在多个用户组。
>存储用户和用户组信息的配置文件
- /etc ：存放系统管理的所有配置文件及子目录
- /etc/group ：存储当前系统中用户组信息
  - 查看group文件配置信息：cat /etc/group
  - 每一行 对应 一个用户组信息，每一行有四个字段，每个字段之间由冒号分隔。每个字段中如果是多个字段组成的，用逗号隔开。
    - `adm:x:4:adm,daemon`
    - **组名称**:组密码占位符:组编号:**组中用户名列表**
      - 组中用户名列表 没值的情况：用户名和用户组名相同，且用户组内只有一个用户时，可以省略不写。
      - 组编号：root用户编号是0；组编号 **1-499** 是系统预留编号，预留给服务和软件。一般情况是将未被使用的最小组编号分配给服务或软件；用户手动创建的组编号从 **500** 开始。
      - 组密码占位符：x
  
- /etc/gshadow：存储系统中当前用户组密码信息
  - 每一行是一个用户组密码的信息，4个字段，用冒号隔开。
    - haldaemon:!::haldaemon
    - **组名称**:组密码:组管理者:**组中用户名列表**
      - 组密码：“空、*、!”表示没有组密码。
        - 没有组密码意味着没有组管理员。
      - 组管理者：一般都是空，表示**组内任何一个用户都可以管理这个组**。
- /etc/passwd：存储系统中所有用户信息
  - 每一行是一个用户信息，7个字段，用冒号隔开
    - root：:x:：0:0:root:/root:/bin/bash
    - **用户名:用户密码占位符:用户编号UID:用户组编号GID:用户注释信息:用户主目录:shell类型**
      - shell：执行用户命令的硬件接口。
      - 查看shell类型命令：echo $SHELL
- /etc/shadow：存储系统中所有用户的密码
  - 该文件权限：----------
  - 每一行是一个用户密码信息，9个字段，用冒号隔开
    - bin:*:15980:0:99999:7:::
    - **用户名:真实单向加密密码:最后一次修改时间:最小时间间隔:最大时间间隔:警告时间:账号限制时间:失效时间:标志**
        - 密码：密码字段值删除后，登录不再需要密码；
          - 由于各种密码的编码技术不一样，不同的编码系统会造成这个字段长度不同。由于固定的编码系统产生的密码长度必须一致，因此，当该字段的长度改变后，密码就会失效。通过在该字段前加上*或！改变密码长度，可以让密码失效。
        - **最后一次修改时间**：从某个时刻起，到用户最后一次修改密码时的天数。时间起点对不同系统可能不一样，一般从1970年1月1日开始记，以天为单位；
        - 最小时间间隔：两次修改密码之间所需的最小天数，表示账号密码被修改后至少经过多少天后才能再次被修改；
        - 最大时间间隔：最大时间间隔后必须修改密码，否则无法登陆；
        - 警告时间：从系统开始警告用户到用户密码正式失效之间的天数。在这段时间内系统会发送警告信息给对应用户，告诉用户还有多少天密码过期；
        - 账号限制时间：用户密码过期后，允许不修改密码时间的天数。在这段期间内用户仍然可以用对应账号登录系统，，但登录后，系统会强制要求你必须重新设定密码才能继续使用。否则，过了账号限制时间，该账号密码永远失效。
        - 失效时间：给的是一个绝对天数，即，给出了账号的生存期。期满后，该账号不再是一个合法账号，无法再用来登录。

**起初，只有group 和passwd 两个文件，密码占位符的位置写着密码，但是由于会经常使用到这两个文件，密码又属于敏感数据，所以将密码单独写到gshadow和shadow两个文件中保存。**

## Linux中用户和用户组命令
### 用户组命令
- 增删改查
- 添加（创建）用户组，只命名：**addgroup 用户组名**
  - cat /etc/group：查看文件，已经将信息添加到了此文件。
- 修改用户组名称：**groupmod -n 新用户组名 旧用户组名**
- 修改用户组编号：**groupmod -g 用户组编号 用户组名**
- 创建用户组，命名并设置组编号：**groupadd -g 组编号 用户组名**
- 删除用户组：**groupdel 用户组名**
  - 删除用户组前，必须先删除用户信息，否则他们的用户配置文件中关于用户组的信息就会无法和用户组匹配，变成系统黑入口，后期权限会受影响。

### 用户命令
- 往用户组中添加用户：**useradd -g 用户组名 用户名**
  - 未指定用户目录，系统会自动创建：/home/用户名同名文件夹
- 创建用户，并指定用户文件夹：**useradd -d 用户目录 用户名**
  - 未指定用户组，系统自动创建一个和用户名相同的用户组。
  - 如果不加参数，则默认在/home/用户名 生成同用户名文件夹。
- 添加用户注释：**usermod -c 注释信息 用户名**
- 修改用户名：**usermod -l 新用户名 旧用户名**
  - 修改新用户目录：**useradd -d 目录 用户名**
- 修改用户所属用户组：**usermod -g 目标用户组组名 原用户组组名**
- 删除用户：**userdel 用户名**
  - 不会删除 用户 个人文件件中的文件
- 删除用户，并删除其个人文件：**userdel -r 用户名**
  - 注意:直接写用户名，不要附加目录。
- 暂时禁止普通账户登录服务器：**touch /etc/nologin**
  - 文件内容无关紧要，创建空文件即可。
- 

## Linux中用户和用户组进阶命令

- 锁定账户：**passwd -l 用户名**
- 解锁用户：**passwd -u 用户名**
- 无密码登录：**passwd -d 用户名**

### 主要组 与 附属组
> 用户可以同时属于多个组
  - 一个主要组
  - 其他是附属组

>命令
- 添加附属组：**gpasswd -a 用户名 附属用户组名1,附属组名2...**
  - 用户同时属于主用户组 和 附属用户组
  - usermod -g 主要用户组名 用户名：修改用户主要用户组
- 切换到附属组：**newgrp 目标用户组名**
    - 一个用户有多个附属组，其创建的文件默认属于**主要组**。如果想要以附属组组员的身份创建一个文件，要把身份临时切换到附属组。
    - 当用户把身份切换到附属用户组时，需要使用**附属组用户密码**
    - 切换用户：root用户，切换到普通用户，再执行**newgrp 目标用户组**命令
- 从附属组 切换回 主用户组：**gpasswd -d 用户名 附属用户组**
- 同时指定主要组和附属组：**useradd -g 主要组名称 -G 附属组名称1，附属组名称2...**
- 设置用户组密码：**gpasswd 用户组名**，点击回车，输入密码。


## Linux中用户管理其他命令
- 切换用户身份：**su 用户名**
  - su：切换到root用户
  - 当前是root用户登录：su 普通用户名，直接切换，不需要秘密。
  - 当前是普通用户登录：
    - su，需要root用户的密码，才可以切换到超级用户。
    - su 目标普通用户名：需要普通用户密码。

- Whoami：显示当前登录用户用户名
- id 用户名：
  - 显示指定用户信息，包括用户编号，用户名，主要组编号，主要组用户名，附属组列表
- groups 用户名：显示指定用户的所有用户组（主要组和附属组）。
- chfn 用户名：改变用户资料，依次输入用户资料（会提问）。
- finger 用户名：显示用户详细信息。